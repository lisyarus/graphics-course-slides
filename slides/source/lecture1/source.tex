% (c) Nikita Lisitsa, lisyarus@gmail.com, 2021

\documentclass{beamer}

\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}

\usepackage{graphicx}
\graphicspath{ {./images/} }

\usepackage{adjustbox}

\usepackage{color}
\usepackage{soul}

\usepackage{hyperref}

\definecolor{blue}{rgb}{0,0,1}
\definecolor{red}{rgb}{1,0,0}

\makeatletter
\newcommand{\slideimage}[1]{
  \begin{figure}
    \begin{adjustbox}{width=\textwidth, totalheight=\textheight-2\baselineskip-2\baselineskip,keepaspectratio}
      \includegraphics{#1}
    \end{adjustbox}
  \end{figure}
}
\makeatother

\title{Компьютерная графика}
\subtitle{Лекция 1: Введение в курс}
\date{2021}

\begin{document}

\frame{\titlepage}

\begin{frame}<1-2>[label=what_is]
\frametitle{Что такое компьютерная графика?}
\begin{itemize}
\pause % 1
\item Кинематограф, мультипликация
\pause % 2
\item Компьютерные игры
\pause % 3
\item Рисунки, concept art
\pause % 4
\item Графический интерфейс
\pause % 5
\item Визуализация данных
\pause % 6
\item Научная визуализация
\pause % 7
\item Карты
\pause % 8
\item И т.д.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\only<2>{The Matrix Revolutions (2003)}}
\begin{figure}
\slideimage{matrix.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Avatar (2009)}}
\begin{figure}
\slideimage{avatar.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{The Avengers (2012)}}
\begin{figure}
\slideimage{avengers.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Klaus (2019)}}
\begin{figure}
\slideimage{klaus.jpg}
\end{figure}
\end{frame}

\againframe<3>{what_is}

\begin{frame}
\frametitle{\only<2>{Space Invaders (1978)}}
\begin{figure}
\slideimage{space-invaders.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Doom (1993)}}
\begin{figure}
\slideimage{doom.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Grand Theft Auto: Vice City (2002)}}
\begin{figure}
\slideimage{vice-city.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Civilization V (2010)}}
\begin{figure}
\slideimage{civ-5.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{The Witcher 3: Wild Hunt (2015)}}
\begin{figure}
\slideimage{witcher.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Cyberpunk 2077 (2020)}}
\begin{figure}
\slideimage{cyberpunk.jpg}
\end{figure}
\end{frame}

\againframe<4>{what_is}

\begin{frame}
\begin{figure}
\slideimage{night.png}
\end{figure}
\end{frame}

\begin{frame}
\begin{figure}
\slideimage{tunnel.png}
\end{figure}
\end{frame}

\begin{frame}
\begin{figure}
\slideimage{forest.jpg}
\end{figure}
\end{frame}

\againframe<5>{what_is}

\begin{frame}
\frametitle{\only<2>{Mac OS Catalina}}
\begin{figure}
\slideimage{macos.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Windows 10}}
\begin{figure}
\slideimage{windows.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Europa Universalis 4}}
\begin{figure}
\slideimage{eu4.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Dear ImGui}}
\begin{figure}
\slideimage{imgui.png}
\end{figure}
\end{frame}

\againframe<6>{what_is}

\begin{frame}
\frametitle{Популярность браузеров в 2002-2009}
\begin{figure}
\slideimage{browsers.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Карта землетрясений}}
\begin{figure}
\slideimage{earthquakes.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{\only<2>{Количество случаев заражения COVID-19}}
\begin{figure}
\slideimage{covid.png}
\end{figure}
\end{frame}

\againframe<7>{what_is}

\begin{frame}
\frametitle{Неустойчивость Рэлея — Тейлора}
\begin{figure}
\slideimage{fluids.jpg}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{Молекулярные орбитали бензола}
\begin{figure}
\slideimage{benzene.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{Симуляция напряжений в стенте методом конечных элементов}
\begin{figure}
\slideimage{stent.jpg}
\end{figure}
\end{frame}

\againframe<8>{what_is}

\begin{frame}
\frametitle{Схематическая карта}
\begin{figure}
\slideimage{map.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{Спутниковая карта}
\begin{figure}
\slideimage{satellite.png}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{Карта погоды}
\begin{figure}
\slideimage{weather.png}
\end{figure}
\end{frame}

\againframe<9>{what_is}

\begin{frame}
\frametitle{Грубая и неточная классификация}
\pause
\begin{itemize}
\item \only<2>{2D / 3D} \pause \only<3->{2D / 2.5D / 3D}
\pause
\item Векторная / растровая
\pause
\item \only<5>{Realtime / offline} \pause \only<6->{Realtime / near real-time / offline}
\pause
\item Фотореалистичная / стилизованная
\pause
\item CPU / GPU
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Чем мы будем заниматься?}
\begin{itemize}
\item \only<-1>{2D / 2.5D / 3D}\only<2->{{\color{blue}\underline{2D / 2.5D / 3D}}}
\item \only<-2>{Векторная / растровая}\only<3->{{\color{blue}\underline{Векторная / растровая}}}
\item \only<-3>{Realtime}\only<4->{{\color{blue}\underline{Realtime}}} / near real-time / offline
\item \only<-4>{Фотореалистичная / стилизованная}\only<5->{{\color{blue}\underline{Фотореалистичная / стилизованная}}}
\item CPU / \only<-5>{GPU}\only<6->{{\color{blue}\underline{GPU}}}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Как использовать GPU? \only<2->{Графические API:}}
GPU - Graphics Processing Unit
\pause
\pause
\begin{itemize}
\item Вендор-специфичные API (1980е - 1990е)
\pause
\item OpenGL (Silicon Graphics, 1992)
\pause
\begin{itemize}
\item \only<-10>{OpenGL 3.3 (Khronos Group, 2010)}\only<11->{\color{blue}\underline{OpenGL 3.3 (Khronos Group, 2010)}}
\end{itemize}
\pause
\item DirectX (Microsoft, 1995)
\pause
\begin{itemize}
\item {\only<10->{\color{red}}DirectX 12 (Microsoft, 2015)}
\end{itemize}
\pause
\item {\only<10->{\color{red}}Metal (Apple, 2014)}
\pause
\item {\only<10->{\color{red}}Vulkan (Khronos Group, 2018)}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Как использовать GPU? API общего назначения (GPGPU):}
GPGPU - General-Purpose Graphics Processing Unit
\pause
\begin{itemize}
\item CUDA (Nvidia, 2007)
\pause
\item DirectX 11 DirectCompute (Microsoft, 2008)
\pause
\item OpenCL (Khronos Group, 2009)
\pause
\item OpenGL 4.3 Compute Shaders (Khronos Group, 2012)
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Почему OpenGL 3.3?}
\pause
\begin{itemize}
\item Широкая поддержка: интегрированные GPU, встраиваемые устройства, телефоны, web
\pause
\item Поддерживает всё, что нам нужно
\pause
\item +/- Кроссплатформенность
\pause
\item Низкий порог вхождения
\pause
\item Достаточно старый API
\begin{itemize}
\item Много вспомогательных библиотек
\item Известны best practices
\item Известны все грабли \pause (их много)
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{История графических API: OpenGL 1.0}
\begin{verbatim}
for o in scene.objects:
    glBegin(GL_TRIANGLES)
    for t in o.triangles:
        for v in t.vertices:
            glColor3f(v.color)
            glNormal3f(v.normal)
            glVertex3f(v.position)
    glEnd(GL_TRIANGLES)
\end{verbatim}
\pause
\begin{itemize}
\item Данные хранятся в памяти CPU
\pause
\item Несколько OpenGL-вызовов на каждую вершину
\pause
\begin{itemize}
\item GPU становятся быстрее $\Longrightarrow$ основное время тратится не на рисование, а на накладные расходы самих OpenGL-вызовов
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{История графических API: OpenGL 1.0 (1992)}
\begin{itemize}
\item Предварительно записать список команд в отдельную сущность - display list
\begin{itemize}
\item Выполнить все команды из списка одной командой \verb|glCallList|
\item Не любой OpenGL-вызов может быть частью display list'а
\item Предок command queues в Vulkan и подобных API
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 1.0 (1992)}
\begin{itemize}
\item Вершины задаются OpenGL-вызовами
\item Display lists
\item Матрицы преобразований вершин: позиционирование объектов и камеры
\item Fixed-function pipeline: настраиваемая, но не расширяемая последовательность операций
\item Асинхронный API: команды выполнятся на GPU когда-нибудь
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{История графических API: OpenGL 1.1 (1997)}
\begin{itemize}
\item Vertex array - спецификация формата и расположения вершин
\begin{itemize}
\item Нарисовать все вершины одной командой \verb|glDrawArrays|
\item Вершины всё ещё хранятся на CPU
\end{itemize}
\pause
\item Текстуры - изображения в памяти GPU, натягиваемые на полигоны
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 1.2 - 1.4 (1998 - 2002)}
\begin{itemize}
\item В текстурах можно записать очень много интересного: normal map, material map, bump map
\item Хочется выполнять сложные вычисления на каждый пиксель
\item $\Longrightarrow$ Texture environments - зачатки программируемости GPU
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 1.5 (2003)}
\begin{itemize}
\item Vertex buffer - возможность хранить вершины в памяти GPU
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 2.0 (2004)}
\begin{itemize}
\item Шейдеры: программы на C-подобном языке GLSL, компилируемые под конкретную GPU
\item Заменяют fixed-function pipeline
\begin{itemize}
\item Необходимые части fixed-function pipeline остаются
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{История графических API: OpenGL 2.0 (2004)}
\begin{verbatim}
// на старте
for o in scene.objects:
    o.createShader()
    o.uploadVertices()

// при рендеринге
for o in scene.objects:
    glUseProgram(o.shader)
    glBindVertexArray(o.vertexArray)
    glDrawArrays(o.vertexCount)
\end{verbatim}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 3.0 (2008)}
\begin{itemize}
\item Огромная часть API объявлена deprecated
\pause
\item Transform feedback - возможность записать результат работы шейдеров обратно в вершинный буфер
\begin{itemize}
\item Зачатки GPGPU
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 3.1 (2009)}
\begin{itemize}
\item Объявленные deprecated возможности удалены
\pause
\item Instanced rendering - нарисовать много копий одного объекта в разных местах одной командой
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 3.2 (2009)}
\begin{itemize}
\item Механизм профилей
\begin{itemize}
\item Core profile
\begin{itemize}
\item Обязан поддерживаться
\item Только функционал конкретной версии OpenGL
\end{itemize}
\item Compatibility profile
\begin{itemize}
\item Не обязан поддерживаться
\item Функционал этой и всех предыдущих версий OpenGL
\end{itemize}
\end{itemize}
\pause
\item Геометрические шейдеры - возможность менять тип геометрии и количество вершин на лету
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 4.0 (2010)}
\begin{itemize}
\item Шейдеры тесселяции - увеличивают детализацию геометрии на лету
\begin{itemize}
\item Гораздо меньше возможностей, чем у геометрических шейдеров, зато быстрее
\end{itemize}
\pause
\item Indirect drawing - можно вычислять количество вершин и их расположение в памяти на лету на GPU, и использовать вычисленные значения для команд рисования
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: OpenGL 4.1 - 4.7 (2010 - 2017)}
\begin{itemize}
\item Compute shaders - настоящее GPGPU внутри OpenGL
\item Проработка и детализация API
\item Атомарные операции в шейдерах
\item Вливание расширений в стандарт OpenGL
\item \url{www.khronos.org/opengl/wiki/History_of_OpenGL}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{История графических API: Vulkan 1.1 (2018)}
\begin{itemize}
\item 700 строк кода, чтобы нарисовать один треугольник
\pause
\item Крайне низкоуровневый API
\item Последовательности команд (command queues) в явном виде (display lists done right)
\begin{itemize}
\item Можно распараллелить генерацию command queues на несколько CPU
\end{itemize}
\pause
\item Похож на DirectX 12, Metal
\item \url{vulkan-tutorial.com}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Разновидности OpenGL}
\begin{itemize}
\item OpenGL
\pause
\item OpenGL ES (Embedded Systems)
\begin{itemize}
\item OpenGL ES 1.0 $\approx$ OpenGL 1.3
\item OpenGL ES 2.0 $\approx$ OpenGL 2.0
\item OpenGL ES 3.0 $\approx$ OpenGL 3.0
\end{itemize}
\pause
\item WebGL
\begin{itemize}
\item WebGL 1.0 $\approx$ OpenGL ES 2.0
\item WebGL 2.0 $\approx$ OpenGL ES 3.0
\end{itemize}
\pause
\item OpenGL SC (Safety Critical)
\begin{itemize}
\item Убраны любые способы отстрелить себе ногу, но в ущерб производительности
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Что такое OpenGL?}
\begin{itemize}
\item {\color{red}Не} библиотека
\item Спецификация API (документ) на языке C
\begin{itemize}
\item Описание констант-перечислений (тэгов)
\item Описание сигнатур функций и их семантики
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Что такое реализация OpenGL?}
\begin{itemize}
\item Заголовочный файл, поставляемый системой или драйвером
\begin{itemize}
\item Определение типов, e.g. \verb|typedef unsigned int GLenum;|
\item Определение констант, e.g. \verb|#define GL_TEXTURE_2D 0x0DE1|
\item Объявление функций, e.g. \verb|void glBindTexture(GLenum target, GLuint texture);|
\end{itemize}
\pause
\item Бинарная реализация объявленных функций (обычно - динамическая библиотека), поставляемая системой и/или драйвером
\begin{itemize}
\item Может содержать непосредственную реализацию OpenGL как часть драйвера и общаться с GPU
\item Может быть промежуточным звеном, маршрутизирующим вызов до драйвера
\item Может быть заглушкой
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Что такое реализация OpenGL?}
\begin{itemize}
\item Заголовочный файл
\begin{itemize}
\item Linux: \verb|GL/gl.h| - до OpenGL 1.3
\pause
\item Windows: \verb|GL/gl.h| - до OpenGL 1.1
\pause
\item MacOS: \verb|OpenGL/gl.h| - до OpenGL 2.1
\begin{itemize}
\item {\color{red}Не} \verb|OpenGL/OpenGL.h|
\end{itemize}
\item Все платформы: \verb|GL/glext.h| вместе с \verb|#define GL_GLEXT_PROTOTYPES| - до OpenGL 4.6
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Что такое реализация OpenGL?}
\begin{itemize}
\item Динамическая библиотека
\begin{itemize}
\item Linux: \verb|libGL.so|
\item Windows: \verb|opengl32.dll|
\item MacOS: \verb|OpenGL framework|
\end{itemize}
\pause
\item Может не содержать функции всех версий OpenGL
\begin{itemize}
\item Под Linux обычно содержит
\end{itemize}
\item Остальные функции OpenGL нужно динамически загружать специфичными для платформы средствами
\item $\Longrightarrow$ Библиотеки-загрузчики OpenGL
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Загрузчики OpenGL}
\begin{itemize}
\item С и C++ specific, для других языков обычно встроено в обёртку над OpenGL
\item \url{www.khronos.org/opengl/wiki/OpenGL_Loading_Library}
\item Обычно содержат код, автоматически сгенерированный по XML-спецификации OpenGL
\item Мы будем использовать {\color{blue}\underline{GLEW}}
\begin{itemize}
\item Но вы можете использовать что угодно!
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Контекст OpenGL}
\begin{itemize}
\item Привязан к конкретной реализации OpenGL
\item Привязан к конкретной версии OpenGL
\item Привязан к экрану / окну оконной системы / изображению в памяти
\item Хранит текущее глобальное состояние OpenGL
\item \url{www.khronos.org/opengl/wiki/OpenGL_Context}
\item Создаётся специфичными для платформы средствами
\item $\Longrightarrow$ Библиотеки, создающие контекст OpenGL
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Библиотеки, создающие контекст OpenGL}
\begin{itemize}
\item Обычно привязывают контекст к окну и умеют обрабатывать события оконной системы
\item GLUT - устаревшая, плохой интерфейс
\item GLFW
\item {\color{blue}\underline{SDL2}} - умеет загружать изображения, выводить звук, и другое
\item \url{open.gl/context}
\begin{itemize}
\item Можете использовать любую
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Как начать работать с OpenGL?}
\begin{verbatim}
window = createWindow(title)
context = createGLContext(window, version, profile)
context.makeCurrent()
loadGLFunctions()
// тут можно работать с OpenGL!
\end{verbatim}
\end{frame}

\end{document}